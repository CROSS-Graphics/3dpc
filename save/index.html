<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>3DPC (3D Print Calculator)</title>

<style>
:root{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#ffffff;
  --muted:#aaaaaa;
  --input:#2a2a2a;
  --border:#333;
  --accent:#3a6cff;
  --shadow:0 10px 30px rgba(0,0,0,.4);
}
.light{
  --bg:#f2f4f8;
  --card:#ffffff;
  --text:#111;
  --muted:#555;
  --input:#f3f5fb;
  --border:#d9deea;
  --shadow:0 10px 24px rgba(0,0,0,.08);
}

*{box-sizing:border-box}
body{
  margin:0;
  height:100vh;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui;
}
.app{
  height:100%;
  display:flex;
  flex-direction:column;
}

/* HEADER */
.header{
  height:52px;
  padding:0 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.logo{
  display:flex;
  align-items:center;
  color:#ffffff; /* —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ */
}

.light .logo{
  color:#111111; /* —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
}

.logo svg{
  width:28px;
  height:28px;
  flex-shrink:0;
}
.logo-box{
  width:24px;height:24px;
  border-radius:6px;
  background:var(--accent);
}
.controls span{
  margin-left:14px;
  cursor:pointer;
  color:var(--muted);
}

/* CONTENT */
.content{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
}
.panel{
  width:900px;
  display:grid;
  grid-template-columns:1.2fr 1fr;
  gap:16px;
}

.card{
  background:var(--card);
  border-radius:18px;
  padding:16px;
  box-shadow:var(--shadow);
}

label{
  display:block;
  margin-top:10px;
  font-size:12px;
  color:var(--muted);
}
label.strong{
  font-weight: 700;
}
input,select{
  width:100%;
  margin-top:4px;
  padding:8px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--input);
  color:var(--text);
}
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
button{
  margin-top:14px;
  width:100%;
  padding:10px;
  border-radius:12px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

/* RESULT */
.result{
  font-size:45px;
  font-weight:800;
}
.breakdown{
  margin-top:10px;
  border-top:1px dashed var(--border);
  padding-top:10px;
  font-weight:350
}
.breakdown span{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  margin-top:6px;
}
.breakdown b{font-weight:700}
.active-printer{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:600;
}

.printer-emoji{
  font-size:26px;   /* –º–æ–∂–Ω–æ 14‚Äì18 */
  line-height:1;
}
</style>
</head>

<body>
<div class="app">

<!-- HEADER -->
<div class="header">
  <div class="active-printer">
    <span class="printer-emoji">üñ∂</span>
    <b id="printerName">‚Äî</b>
  </div>
  <div class="controls">
    <span onclick="toggleLang()">RU / EN</span>
    <span onclick="toggleTheme()">üåô / ‚òÄÔ∏è</span>
  </div>
</div>

<!-- CONTENT -->
<div class="content">
<div class="panel">

<!-- LEFT -->
<div class="card">
  <label data-i="weight" class="strong"></label>
  <input id="weight" value="65">

  
  <label data-i="material"></label>
  <select id="material">
    <option>PLA</option>
    <option>PETG</option>
    <option>ABS</option>
  </select>

  <div class="row">
    <div>
      <label data-i="time" class="strong"></label>
      <input id="time" value="33">
    </div>
    <div>
      <label data-i="qty" class="strong"></label>
      <input id="qty" value="12">
    </div>
  </div>

  <label data-i="complexity"></label>
  <input id="complexity" value="1">

  <label data-i="prototype"></label>
  <select id="prototype">
    <option value="0" data-i="no"></option>
    <option value="1" data-i="yes"></option>
  </select>

  <label data-i="modeling"></label>
  <input id="modeling" value="10">

  <label data-i="post"></label>
  <input id="post" value="2">

  <label data-i="other"></label>
  <input id="other" value="0">

  <button onclick="calculate()" data-i="calc"></button>
</div>

<!-- RIGHT -->
<div class="card">
  <div class="result" id="total">$0.00</div>
  <div class="breakdown" id="details"></div>
</div>

</div>
</div>
</div>

<script>
/* ===== DOM ===== */
const weight = document.getElementById('weight')
const time = document.getElementById('time')
const qty = document.getElementById('qty')
const complexity = document.getElementById('complexity')
const material = document.getElementById('material')
const prototype = document.getElementById('prototype')
const modeling = document.getElementById('modeling')
const post = document.getElementById('post')
const other = document.getElementById('other')
const totalEl = document.getElementById('total')
const details = document.getElementById('details')
const printerName = document.getElementById('printerName')

/* ===== LANGUAGE ===== */
let lang = localStorage.getItem('lang') || 'ru'
const dict = {
  ru:{
    weight:'–í–µ—Å –¥–µ—Ç–∞–ª–∏ (–≥)',material:'–¢–∏–ø –ø–ª–∞—Å—Ç–∏–∫–∞',
    time:'–í—Ä–µ–º—è –ø–µ—á–∞—Ç–∏ (–º–∏–Ω)',qty:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
    complexity:'–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏',
    prototype:'–ü—Ä–æ—Ç–æ—Ç–∏–ø',
    no:'–ù–µ—Ç',yes:'–î–∞',
    modeling:'–ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ ($)',
    post:'–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ ($/—à—Ç)',
    other:'–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏ ($)',
    calc:'–†–∞—Å—Å—á–∏—Ç–∞—Ç—å',

    materialCost:'–ú–∞—Ç–µ—Ä–∏–∞–ª',
    electricity:'–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è',
    amort:'–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è',
    print:'–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—á–∞—Ç–∏',
    modelingCost:'–ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ',
    postCost:'–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞',
    otherCost:'–ü—Ä–æ—á–∏–µ —É—Å–ª—É–≥–∏',
    prototypeCost:'–ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞'
  },
  en:{
    weight:'Weight (g)',material:'Material',
    time:'Print time (min)',qty:'Quantity',
    complexity:'Complexity factor',
    prototype:'Prototype printing',
    no:'No',yes:'Yes',
    modeling:'Modeling ($)',
    post:'Post-processing ($/unit)',
    other:'Other services ($)',
    calc:'Calculate',

    materialCost:'Material',
    electricity:'Electricity',
    amort:'Depreciation',
    print:'Printing price',
    modelingCost:'Modeling',
    postCost:'Post-processing',
    otherCost:'Other',
    prototypeCost:'Prototype'
  }
}

function applyLang(){
  document.querySelectorAll('[data-i]').forEach(e=>{
    e.innerText = dict[lang][e.dataset.i]
  })

  if (window.menuAPI?.setLang) {
    
  }
}
function toggleLang(){
  lang = lang === 'ru' ? 'en' : 'ru'
  localStorage.setItem('lang', lang)
  applyLang()
}

/* ===== THEME ===== */
function toggleTheme(){
  document.body.classList.toggle('light')
  localStorage.setItem(
    'theme',
    document.body.classList.contains('light') ? 'light' : 'dark'
  )
}
if(localStorage.getItem('theme') === 'light'){
  document.body.classList.add('light')
}

/* ===== CALC ===== */
async function calculate(){
  const data = await window.printersAPI.load()
  const s = data.printers[data.activePrinter]
  printerName.innerText = data.activePrinter

  const w = +weight.value
  const t = +time.value
  const q = +qty.value
  const c = +complexity.value

  const materialCost = (w/1000) * s.prices[material.value]
  const electricity = (s.power/1000) * (t/60) * s.tariff
  const amort = s.amort * (t/60)

  const base = (materialCost + electricity + amort) * c
  const printCost = base * s.markup

  const proto = prototype.value === '1' ? printCost * 0.75 : 0

  const total =
    (printCost * q) +
    (+modeling.value) +
    (+post.value * q) +
    (+other.value) +
    proto

  totalEl.innerText = `$${total.toFixed(2)}`
  details.innerHTML = `
    <span>${dict[lang].materialCost} <b>$${materialCost.toFixed(2)}</b></span>
    <span>${dict[lang].electricity} <b>$${electricity.toFixed(2)}</b></span>
    <span>${dict[lang].amort} <b>$${amort.toFixed(2)}</b></span>
    <span>${dict[lang].print} <b>$${printCost.toFixed(2)}</b></span>
    <span>${dict[lang].modelingCost} <b>$${(+modeling.value).toFixed(2)}</b></span>
    <span>${dict[lang].postCost} <b>$${(+post.value * q).toFixed(2)}</b></span>
    <span>${dict[lang].otherCost} <b>$${(+other.value).toFixed(2)}</b></span>
    <span>${dict[lang].prototypeCost} <b>$${proto.toFixed(2)}</b></span>
  `
}

/* ENTER ‚Üí CALC */
document.addEventListener('keydown', e=>{
  if(e.key === 'Enter') calculate()
})

applyLang()
</script>
</body>
</html>
